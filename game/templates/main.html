<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>TrumpOUT</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.min.js"></script>
  <script type="text/javascript">
    var wasPendingJ = false;
    var reloadedOnRoundOver = false;
    var socket = io();
    socket.on('connect', function() {
      console.log('서버와 연결되었습니다.');
    });
    socket.on('game_state_update', function(data) {
      // 사이드바, 핸드, 대시보드 동시 업데이트
      updateSidebar(data);
      updateHand(data);
      updateDashboard(data);
    });
    socket.on('game_over', function() {
      // 모든 플레이어가 즉시 결과 화면으로 이동
      window.location.reload();
    });
  </script>
  <style>
    body {
      margin: 10px;
    }
    .container { display: flex; }
    .left      { flex: 1.5; padding: 10px; }
    .right     { flex: 1; padding: 10px; }
    .dashboard { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h4>TrumpOUT</h4>
  <p>플레이어: {{ player_name }}</p>

  {% from "sidebar.html"   import sidebar %}
  {% from "dashboard.html" import dashboard %}
  {% from "hand_zone.html" import hand_zone %}

  {% if game_over %}
    <h2>게임 종료</h2>
    <p>최종 점수:</p>
    <ul>
      {% for name, score in final_scores.items() %}
        <li>{{ name }}: {{ score }}</li>
      {% endfor %}
    </ul>
    <br><a href="/reset">게임 초기화</a>

  {% else %}
    <div class="container">
      <div class="left">
        {{ dashboard() }}
      </div>
      <div class="right">
        {{ sidebar() }}
      </div>
    </div>

    {{ hand_zone() }}
  {% endif %}

  <br>
  <form method="GET" action="/logout">
    <button type="submit">나가기</button>
  </form>
  <div id="gameState" style="display: none;"></div>
</body>
</html>